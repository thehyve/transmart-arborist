{% extends "layout.html" %}
{% block title %}Studies overview{% endblock %}
{% block content %}
	<p>Studies are recognized based on the folder containing a <code>study.params</code> or <code>clinical.params</code> file.<br />
		You are currently in the folder: '<code>/{{ studiesfolder }}</code>'.</p>

	{% if not parentfolder == '' %}
		{% set parenturl = url_for('studies_overview', studiesfolder=parentfolder) %}
	{% else %}
		{% set parenturl = url_for('studies_overview') %}
	{% endif %}

	{% if not studiesfolder == '' %}
		{% set createfolderurl = url_for('create_folder', studiesfolder=studiesfolder) %}
	{% else %}
		{% set createfolderurl = url_for('create_folder') %}
	{% endif %}

	<p>
	{% if not studiesfolder == '' %}
	<a href="{{ parenturl }}" id="gotoparent">
		<img style="padding-right:5px; vertical-align:middle;" src="{{ url_for('static', filename='img/tree/folder.gif') }}" />Go to parent directory
	</a> -
	{% endif %}
		<a id="newfolderlink" href="{{ createfolderurl }}">
			<img style="padding-right:5px; vertical-align:middle;" src="{{ url_for('static', filename='img/addfolder.png') }}" />Create new folder
		</a>
	</p>

	<form method="post" id="newfolderform" action="{{ createfolderurl }}">
		<input type="hidden" name="foldername" />
	</form>

	<ul class="folderlist">
	{% for study in studies %}

		{% if not studiesfolder == '' %}
			{% set folderurl = url_for('studies_overview', studiesfolder=(studiesfolder, study)|path_join) %}
			{% set studyurl = url_for('study_page', studiesfolder=studiesfolder, study=study) %}
		{% else %}
			{% set folderurl = url_for('studies_overview', studiesfolder=study) %}
			{% set studyurl = url_for('study_page', study=study) %}
		{% endif %}

		{% if studies[study]['type'] == 'study' %}

		<li class="study">
			<a title="Navigate to folder {{study}}" data-foldername="{{study}}" class="gotofolder" href="{{ folderurl }}"><img class="secondary" data-foldername="{{study}}" src="{{ url_for('static', filename='img/tree/folder.gif') }}" style="vertical-align:text-bottom;opacity: 0.2;"></a>
			<a title="Use {{study}} as study" href="{{ studyurl }}"><img class="primary" src="{{ url_for('static', filename='img/tree/study.png') }}" style="vertical-align:text-bottom;opacity: 1;"></a>
			<a href="{{ studyurl }}">{{study}}</a>
		</li>

		{% else %}

		<li class="folder">
			<a title="Navigate to folder {{study}}" data-foldername="{{study}}" class="gotofolder" href="{{ folderurl }}"><img class="primary" data-foldername="{{study}}" src="{{ url_for('static', filename='img/tree/folder.gif') }}" style="vertical-align:text-bottom;opacity: 1;"></a>
			<a title="Use {{study}} as study" href="{{ studyurl }}"><img class="secondary" src="{{ url_for('static', filename='img/tree/study.png') }}" style="vertical-align:text-bottom;opacity: 0.2;"></a>
			<a data-foldername="{{study}}" class="gotofolder" href="{{ folderurl }}">{{study}}</a>
		</li>

		{% endif %}

	{% else %}
		<li>No studies</li>
	{% endfor %}

	</ul>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

<script>

$('img.secondary').hover(
  function () {
		$(this).closest( "li" ).find( "img.primary" ).css( "opacity", 0.2 );
		$(this).css( "opacity", 1 );
  },
  function () {
		$(this).closest( "li" ).find( "img.primary" ).css( "opacity", 1 );
		$(this).css( "opacity", 0.2 );
  }
);

$('#newfolderlink').bind('click', function(event) {
	event.preventDefault();
	var foldername = prompt("Please enter the folder name.\nFor study folders it is recommended to use the Study ID as foldername, which should be unique, capitalized and only contain letters.", "STUDYID");
	if (foldername != '' && foldername != null) {
		$('input[name=foldername]').val(foldername);
		$('#newfolderform').submit();
	}
});

</script>

{% endblock %}
